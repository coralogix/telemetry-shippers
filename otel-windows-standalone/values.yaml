global:
  domain: "eu2.coralogix.com"
  defaultApplicationName: "otel"
  defaultSubsystemName: "windows"
  logLevel: "info"
  collectionInterval: "30s"
  version: "0.0.1"

opentelemetry-agent:
  enabled: true
  distribution: "standalone"
  isWindows: true

  presets:
    metadata:
      enabled: true
      integrationName: "coralogix-windows-standalone"
    hostEntityEvents:
      enabled: true
    fleetManagement:
      enabled: true
      agentType: "agent"
    hostMetrics:
      enabled: true
      process:
        enabled: true
    batch:
      enabled: true
    resourceDetection:
      enabled: true
      provider: ""
    collectorMetrics:
      enabled: true
      scrapeInterval: "{{.Values.global.collectionInterval}}"
    otlpReceiver:
      enabled: true
    zpages:
      enabled: true
    pprof:
      enabled: true
    semconv:
      enabled: true
    coralogixExporter:
      enabled: true
      privateKey: ${env:CORALOGIX_PRIVATE_KEY}

    # Windows-specific presets
    windowsEventLog:
      enabled: true
      # channels:
      #   - System
      #   - Application
      #   - Security

    iisReceiver:
      enabled: true
      collectionInterval: "10s"

    iisLogs:
      enabled: true
      # include:
      #   - "C:\\inetpub\\logs\\LogFiles\\W3SVC*\\*.log"

    # Disabled presets
    spanMetrics:
      enabled: false
      collectionInterval: "{{.Values.global.collectionInterval}}"
      metricsExpiration: 5m
    transactions:
      enabled: false
      waitDuration: 30s
    reduceResourceAttributes:
      enabled: false
      pipelines: ["all"]
    prometheusMulti:
      enabled: false
      scrapeInterval: "15s"
      targets: []
    filelogMulti:
      enabled: false
      receivers: []

  config:
    extensions:
      health_check:
        endpoint: ${env:OTEL_LISTEN_INTERFACE:-0.0.0.0}:13133
      file_storage:
        directory: "C:\\ProgramData\\OpenTelemetry\\Collector\\storage"
    exporters:
      # Manually added for Host Catalog support
      coralogix/resource_catalog:
        application_name: "resource"
        subsystem_name: "catalog"
        domain: "{{.Values.global.domain}}"
        private_key: "${env:CORALOGIX_PRIVATE_KEY}"
        timeout: 30s
        logs:
          headers:
            X-Coralogix-Distribution: "helm-otel-standalone/{{.Values.global.version}}"
            x-coralogix-ingress: "metadata-as-otlp-logs/v1"

    receivers:
      prometheus:
        config:
          scrape_configs:
            - job_name: opentelemetry-collector
              scrape_interval: 30s
              static_configs:
                - targets: ["${env:OTEL_LISTEN_INTERFACE:-0.0.0.0}:8888"]
      otlp:
        protocols:
          grpc:
            endpoint: ${env:OTEL_LISTEN_INTERFACE:-0.0.0.0}:4317
          http:
            endpoint: ${env:OTEL_LISTEN_INTERFACE:-0.0.0.0}:4318

    processors:
      memory_limiter:
        check_interval: 5s
        limit_mib: ${env:OTEL_MEMORY_LIMIT_MIB:-1024}

    service:
      telemetry:
        metrics:
          readers:
            - pull:
                exporter:
                  prometheus:
                    host: ${env:OTEL_LISTEN_INTERFACE:-0.0.0.0}
                    port: 8888
      extensions: [health_check, file_storage, opamp, zpages, pprof]
      pipelines:
        metrics:
          receivers: [otlp]
          processors: [memory_limiter, batch]
          exporters: [coralogix]
        logs:
          receivers: [otlp]
          processors: [memory_limiter, batch]
          exporters: [coralogix]
        # Manually defined Host Catalog pipeline
        logs/resource_catalog:
          receivers: [hostmetrics]
          processors: [memory_limiter, resourcedetection/region, resourcedetection/env, resource/metadata, resourcedetection/entity, transform/entity-event]
          exporters: [coralogix/resource_catalog]
