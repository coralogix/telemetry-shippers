exporters:
  coralogix:
    application_name: otel
    application_name_attributes:
    - service.namespace
    domain: eu2.coralogix.com
    logs:
      headers:
        X-Coralogix-Distribution: helm-otel-standalone/0.0.3
    metrics:
      headers:
        X-Coralogix-Distribution: helm-otel-standalone/0.0.3
    private_key: ${env:CORALOGIX_PRIVATE_KEY}
    profiles:
      headers:
        X-Coralogix-Distribution: helm-otel-standalone/0.0.3
    subsystem_name: linux
    subsystem_name_attributes:
    - service.name
    timeout: 30s
    traces:
      headers:
        X-Coralogix-Distribution: helm-otel-standalone/0.0.3
  coralogix/resource_catalog:
    application_name: resource
    domain: eu2.coralogix.com
    logs:
      headers:
        X-Coralogix-Distribution: helm-otel-standalone/0.0.3
        x-coralogix-ingress: metadata-as-otlp-logs/v1
    private_key: ${CORALOGIX_PRIVATE_KEY}
    subsystem_name: catalog
    timeout: 30s
  debug: {}
extensions:
  health_check:
    endpoint: ${env:OTEL_LISTEN_INTERFACE:-127.0.0.1}:13133
  opamp:
    agent_description:
      include_resource_attributes: true
      non_identifying_attributes:
        cx.agent.type: agent
        helm.chart.opentelemetry-agent.version: 0.127.7
    server:
      http:
        endpoint: https://ingress.eu2.coralogix.com/opamp/v1
        headers:
          Authorization: Bearer ${env:CORALOGIX_PRIVATE_KEY}
        polling_interval: 2m
  pprof:
    endpoint: localhost:1777
  zpages:
    endpoint: localhost:55679
processors:
  batch:
    send_batch_max_size: 2048
    send_batch_size: 1024
    timeout: 1s
  coralogix:
    transactions:
      enabled: true
  groupbytrace/transactions:
    wait_duration: 30s
  memory_limiter:
    check_interval: 5s
    limit_mib: ${env:OTEL_MEMORY_LIMIT_MIB:-512}
  resource/metadata:
    attributes:
    - action: upsert
      key: cx.otel_integration.name
      value: coralogix-linux-standalone
  resourcedetection/entity:
    detectors:
    - system
    - env
    override: false
    system:
      resource_attributes:
        host.cpu.cache.l2.size:
          enabled: true
        host.cpu.family:
          enabled: true
        host.cpu.model.id:
          enabled: true
        host.cpu.model.name:
          enabled: true
        host.cpu.stepping:
          enabled: true
        host.cpu.vendor.id:
          enabled: true
        host.id:
          enabled: true
        host.ip:
          enabled: true
        host.mac:
          enabled: true
        os.description:
          enabled: true
    timeout: 2s
  resourcedetection/env:
    detectors:
    - system
    - env
    override: false
    system:
      resource_attributes:
        host.id:
          enabled: true
    timeout: 2s
  resourcedetection/region:
    detectors:
    - gcp
    - ec2
    - azure
    override: true
    timeout: 2s
  transform/entity-event:
    error_mode: silent
    log_statements:
    - context: log
      statements:
      - set(attributes["otel.entity.id"]["host.id"], resource.attributes["host.id"])
      - merge_maps(attributes, resource.attributes, "insert")
    - context: resource
      statements:
      - keep_keys(attributes, [""])
  transform/journald:
    error_mode: ignore
    log_statements:
    - context: log
      statements:
      - set(resource.attributes["service.name"], body["_SYSTEMD_UNIT"]) where body["_SYSTEMD_UNIT"]
        != nil and body["_SYSTEMD_UNIT"] != ""
      - set(resource.attributes["service.name"], body["SYSLOG_IDENTIFIER"]) where
        body["_SYSTEMD_UNIT"] == nil and body["SYSLOG_IDENTIFIER"] != nil and body["SYSLOG_IDENTIFIER"]
        != ""
      - replace_pattern(resource.attributes["service.name"], "\\.service$", "") where
        resource.attributes["service.name"] != nil and resource.attributes["service.name"]
        != ""
  transform/prometheus:
    error_mode: ignore
    metric_statements:
    - context: metric
      statements:
      - replace_pattern(metric.name, "_total$", "") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_process_cpu_seconds_seconds$", "otelcol_process_cpu_seconds")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_process_memory_rss_bytes$", "otelcol_process_memory_rss_bytes")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_process_runtime_heap_alloc_bytes_bytes$",
        "otelcol_process_runtime_heap_alloc_bytes") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_process_runtime_total_alloc_bytes_bytes$",
        "otelcol_process_runtime_total_alloc_bytes") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_process_runtime_total_sys_memory_bytes_bytes$",
        "otelcol_process_runtime_total_sys_memory_bytes") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_fileconsumer_open_files$", "otelcol_fileconsumer_open_files_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_fileconsumer_reading_files$", "otelcol_fileconsumer_reading_files_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_otelsvc_k8s_ip_lookup_miss$", "otelcol_otelsvc_k8s_ip_lookup_miss_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_otelsvc_k8s_pod_added$", "otelcol_otelsvc_k8s_pod_added_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_otelsvc_k8s_pod_table_size_ratio$",
        "otelcol_otelsvc_k8s_pod_table_size_ratio") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_otelsvc_k8s_pod_updated$", "otelcol_otelsvc_k8s_pod_updated_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_otelsvc_k8s_pod_deleted$", "otelcol_otelsvc_k8s_pod_deleted_ratio")
        where resource.attributes["service.name"] == "opentelemetry-collector"
      - replace_pattern(metric.name, "^otelcol_processor_filter_spans\\.filtered$",
        "otelcol_processor_filter_spans.filtered_ratio") where resource.attributes["service.name"]
        == "opentelemetry-collector"
    - context: resource
      statements:
      - set(attributes["k8s.pod.ip"], attributes["net.host.name"]) where attributes["service.name"]
        == "opentelemetry-collector"
      - delete_key(attributes, "service_name") where attributes["service.name"] ==
        "opentelemetry-collector"
    - context: datapoint
      statements:
      - delete_key(attributes, "service_name") where resource.attributes["service.name"]
        == "opentelemetry-collector"
      - delete_key(attributes, "otel_scope_name") where attributes["service.name"]
        == "opentelemetry-collector"
  transform/reduce:
    error_mode: silent
    log_statements:
    - context: log
      statements:
      - delete_key(resource.attributes, "azure.resourcegroup.name")
      - delete_key(resource.attributes, "azure.vm.name")
      - delete_key(resource.attributes, "azure.vm.scaleset.name")
      - delete_key(resource.attributes, "azure.vm.size")
      - delete_key(resource.attributes, "cloud.account.id")
      - delete_key(resource.attributes, "cloud.availability_zone")
      - delete_key(resource.attributes, "cloud.platform")
      - delete_key(resource.attributes, "cloud.provider")
      - delete_key(resource.attributes, "cloud.region")
      - delete_key(resource.attributes, "container.id")
      - delete_key(resource.attributes, "cx.otel_integration.name")
      - delete_key(resource.attributes, "faas.id")
      - delete_key(resource.attributes, "faas.instance")
      - delete_key(resource.attributes, "faas.name")
      - delete_key(resource.attributes, "faas.version")
      - delete_key(resource.attributes, "gcp.cloud_run.job.execution")
      - delete_key(resource.attributes, "gcp.cloud_run.job.task_index")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.name")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.region")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.zone")
      - delete_key(resource.attributes, "host.image.id")
      - delete_key(resource.attributes, "host.type")
      - delete_key(resource.attributes, "k8s.cronjob.uid")
      - delete_key(resource.attributes, "k8s.container.restart_count")
      - delete_key(resource.attributes, "k8s.daemonset.uid")
      - delete_key(resource.attributes, "k8s.deployment.uid")
      - delete_key(resource.attributes, "k8s.hpa.uid")
      - delete_key(resource.attributes, "k8s.job.uid")
      - delete_key(resource.attributes, "k8s.namespace.uid")
      - delete_key(resource.attributes, "k8s.node.uid")
      - delete_key(resource.attributes, "k8s.pod.start_time")
      - delete_key(resource.attributes, "k8s.pod.uid")
      - delete_key(resource.attributes, "k8s.replicaset.uid")
      - delete_key(resource.attributes, "k8s.statefulset.uid")
      - delete_key(resource.attributes, "os.type")
      - delete_key(resource.attributes, "os.version")
      - delete_key(resource.attributes, "process.command")
      - delete_key(resource.attributes, "process.command_line")
      - delete_key(resource.attributes, "process.command_args")
      - delete_key(resource.attributes, "process.executable.name")
      - delete_key(resource.attributes, "process.executable.path")
      - delete_key(resource.attributes, "process.owner")
      - delete_key(resource.attributes, "process.pid")
      - delete_key(resource.attributes, "process.parent_pid")
      - delete_key(resource.attributes, "process.runtime.description")
      - delete_key(resource.attributes, "process.runtime.name")
      - delete_key(resource.attributes, "process.runtime.version")
      - delete_key(resource.attributes, "telemetry.distro.name")
      - delete_key(resource.attributes, "telemetry.distro.version")
      - delete_key(resource.attributes, "telemetry.sdk.language")
      - delete_key(resource.attributes, "telemetry.sdk.name")
      - delete_key(resource.attributes, "telemetry.sdk.version")
    metric_statements:
    - context: metric
      statements:
      - delete_key(resource.attributes, "azure.resourcegroup.name")
      - delete_key(resource.attributes, "azure.vm.name")
      - delete_key(resource.attributes, "azure.vm.scaleset.name")
      - delete_key(resource.attributes, "azure.vm.size")
      - delete_key(resource.attributes, "cloud.account.id")
      - delete_key(resource.attributes, "cloud.availability_zone")
      - delete_key(resource.attributes, "cloud.platform")
      - delete_key(resource.attributes, "cloud.provider")
      - delete_key(resource.attributes, "cloud.region")
      - delete_key(resource.attributes, "container.id")
      - delete_key(resource.attributes, "cx.otel_integration.name")
      - delete_key(resource.attributes, "faas.id")
      - delete_key(resource.attributes, "faas.instance")
      - delete_key(resource.attributes, "faas.name")
      - delete_key(resource.attributes, "faas.version")
      - delete_key(resource.attributes, "gcp.cloud_run.job.execution")
      - delete_key(resource.attributes, "gcp.cloud_run.job.task_index")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.name")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.region")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.zone")
      - delete_key(resource.attributes, "host.image.id")
      - delete_key(resource.attributes, "host.type")
      - delete_key(resource.attributes, "k8s.cronjob.uid")
      - delete_key(resource.attributes, "k8s.container.restart_count")
      - delete_key(resource.attributes, "k8s.daemonset.uid")
      - delete_key(resource.attributes, "k8s.deployment.uid")
      - delete_key(resource.attributes, "k8s.hpa.uid")
      - delete_key(resource.attributes, "k8s.job.uid")
      - delete_key(resource.attributes, "k8s.namespace.uid")
      - delete_key(resource.attributes, "k8s.node.uid")
      - delete_key(resource.attributes, "k8s.pod.start_time")
      - delete_key(resource.attributes, "k8s.pod.uid")
      - delete_key(resource.attributes, "k8s.replicaset.uid")
      - delete_key(resource.attributes, "k8s.statefulset.uid")
      - delete_key(resource.attributes, "os.type")
      - delete_key(resource.attributes, "os.version")
      - delete_key(resource.attributes, "process.command") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.command_line") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.command_args") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.executable.name") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.executable.path") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.owner") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.pid") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.parent_pid") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.runtime.description") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.runtime.name") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "process.runtime.version") where not IsMatch(metric.name,
        "^process\\.")
      - delete_key(resource.attributes, "net.host.name")
      - delete_key(resource.attributes, "net.host.port")
      - delete_key(resource.attributes, "telemetry.distro.name")
      - delete_key(resource.attributes, "telemetry.distro.version")
      - delete_key(resource.attributes, "telemetry.sdk.language")
      - delete_key(resource.attributes, "telemetry.sdk.name")
      - delete_key(resource.attributes, "telemetry.sdk.version")
    trace_statements:
    - context: span
      statements:
      - delete_key(resource.attributes, "azure.resourcegroup.name")
      - delete_key(resource.attributes, "azure.vm.name")
      - delete_key(resource.attributes, "azure.vm.scaleset.name")
      - delete_key(resource.attributes, "azure.vm.size")
      - delete_key(resource.attributes, "cloud.account.id")
      - delete_key(resource.attributes, "cloud.availability_zone")
      - delete_key(resource.attributes, "cloud.platform")
      - delete_key(resource.attributes, "cloud.provider")
      - delete_key(resource.attributes, "cloud.region")
      - delete_key(resource.attributes, "container.id")
      - delete_key(resource.attributes, "cx.otel_integration.name")
      - delete_key(resource.attributes, "faas.id")
      - delete_key(resource.attributes, "faas.instance")
      - delete_key(resource.attributes, "faas.name")
      - delete_key(resource.attributes, "faas.version")
      - delete_key(resource.attributes, "gcp.cloud_run.job.execution")
      - delete_key(resource.attributes, "gcp.cloud_run.job.task_index")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.name")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.region")
      - delete_key(resource.attributes, "gcp.gce.instance_group_manager.zone")
      - delete_key(resource.attributes, "host.image.id")
      - delete_key(resource.attributes, "host.type")
      - delete_key(resource.attributes, "k8s.cronjob.uid")
      - delete_key(resource.attributes, "k8s.container.restart_count")
      - delete_key(resource.attributes, "k8s.daemonset.uid")
      - delete_key(resource.attributes, "k8s.deployment.uid")
      - delete_key(resource.attributes, "k8s.hpa.uid")
      - delete_key(resource.attributes, "k8s.job.uid")
      - delete_key(resource.attributes, "k8s.namespace.uid")
      - delete_key(resource.attributes, "k8s.node.uid")
      - delete_key(resource.attributes, "k8s.pod.start_time")
      - delete_key(resource.attributes, "k8s.pod.uid")
      - delete_key(resource.attributes, "k8s.replicaset.uid")
      - delete_key(resource.attributes, "k8s.statefulset.uid")
      - delete_key(resource.attributes, "os.type")
      - delete_key(resource.attributes, "os.version")
      - delete_key(resource.attributes, "process.command")
      - delete_key(resource.attributes, "process.command_line")
      - delete_key(resource.attributes, "process.command_args")
      - delete_key(resource.attributes, "process.executable.name")
      - delete_key(resource.attributes, "process.executable.path")
      - delete_key(resource.attributes, "process.owner")
      - delete_key(resource.attributes, "process.pid")
      - delete_key(resource.attributes, "process.parent_pid")
      - delete_key(resource.attributes, "process.runtime.description")
      - delete_key(resource.attributes, "process.runtime.name")
      - delete_key(resource.attributes, "process.runtime.version")
  transform/semconv:
    error_mode: ignore
    trace_statements:
    - context: span
      statements:
      - set(attributes["http.method"], attributes["http.request.method"]) where attributes["http.request.method"]
        != nil
receivers:
  hostmetrics:
    collection_interval: 10s
    root_path: /
    scrapers:
      cpu:
        metrics:
          system.cpu.utilization:
            enabled: true
      disk: null
      filesystem:
        exclude_fs_types:
          fs_types:
          - autofs
          - binfmt_misc
          - bpf
          - cgroup2
          - configfs
          - debugfs
          - devpts
          - devtmpfs
          - fusectl
          - hugetlbfs
          - iso9660
          - mqueue
          - nsfs
          - overlay
          - proc
          - procfs
          - pstore
          - rpc_pipefs
          - securityfs
          - selinuxfs
          - squashfs
          - sysfs
          - tracefs
          match_type: strict
        exclude_mount_points:
          match_type: regexp
          mount_points:
          - /dev/*
          - /proc/*
          - /sys/*
          - /run/k3s/containerd/*
          - /run/containerd/runc/*
          - /var/lib/docker/*
          - /var/lib/kubelet/*
          - /snap/*
      load: null
      memory:
        metrics:
          system.memory.utilization:
            enabled: true
      network: null
  jaeger:
    protocols:
      grpc:
        endpoint: 0.0.0.0:14250
      thrift_binary:
        endpoint: 0.0.0.0:6832
      thrift_compact:
        endpoint: 0.0.0.0:6831
      thrift_http:
        endpoint: 0.0.0.0:14268
  journald: {}
  otlp:
    protocols:
      grpc:
        endpoint: ${env:OTEL_LISTEN_INTERFACE:-127.0.0.1}:4317
        max_recv_msg_size_mib: 20
      http:
        endpoint: ${env:OTEL_LISTEN_INTERFACE:-127.0.0.1}:4318
  prometheus:
    config:
      scrape_configs:
      - job_name: opentelemetry-collector
        scrape_interval: '30s'
        static_configs:
        - targets:
          - 0.0.0.0:8888
  statsd:
    endpoint: 0.0.0.0:8125
  zipkin:
    endpoint: 0.0.0.0:9411
service:
  extensions:
  - health_check
  - opamp
  - zpages
  - pprof
  pipelines:
    logs:
      exporters:
      - debug
      - coralogix
      processors:
      - memory_limiter
      - resourcedetection/region
      - resourcedetection/env
      - resource/metadata
      - transform/reduce
      - transform/journald
      - batch
      receivers:
      - journald
      - otlp
    logs/resource_catalog:
      exporters:
      - coralogix/resource_catalog
      processors:
      - memory_limiter
      - resource/metadata
      - resourcedetection/entity
      - resourcedetection/region
      - transform/entity-event
      receivers:
      - hostmetrics
    metrics:
      exporters:
      - debug
      - coralogix
      processors:
      - memory_limiter
      - resourcedetection/region
      - resourcedetection/env
      - resource/metadata
      - transform/reduce
      - transform/prometheus
      - batch
      receivers:
      - hostmetrics
      - prometheus
      - otlp
      - statsd
    traces:
      exporters:
      - debug
      - coralogix
      processors:
      - memory_limiter
      - resourcedetection/region
      - resourcedetection/env
      - resource/metadata
      - transform/reduce
      - transform/semconv
      - groupbytrace/transactions
      - coralogix
      - batch
      receivers:
      - jaeger
      - zipkin
      - otlp
  telemetry:
    logs:
      encoding: json
      level: info
    metrics:
      readers:
      - pull:
          exporter:
            prometheus:
              host: 0.0.0.0
              port: 8888
    resource:
      service.name: opentelemetry-collector

