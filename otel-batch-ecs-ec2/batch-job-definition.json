{
    "jobDefinitionName": "ecs-batch-sidecar-job",
    "type": "container",
    "platformCapabilities": ["EC2"],
    "retryStrategy": {
      "attempts": 3,
      "evaluateOnExit": []
    },
    "containerOrchestrationType": "ECS",
    "ecsProperties": {
      "taskProperties": [
        {
          "executionRoleArn": "arn:aws:iam::<ACCOUNT_ID>:role/ecsTaskExecutionRole",
          "taskRoleArn": "arn:aws:iam::<ACCOUNT_ID>:role/ecsTaskExecutionRole",
          "volumes": [],
          "containers": [
            {
              "name": "otel-collector",
              "image": "coralogixrepo/coralogix-otel-collector:v0.5.0",
              "essential": false,
              "command": ["--config", "env:OTEL_CONFIG"],
              "environment": [
                {"name": "CX_DOMAIN", "value": "eu1.coralogix.com"},
                {"name": "CX_APPLICATION_NAME", "value": "batch-service"},
                {"name": "CX_PRIVATE_KEY", "value": "send-your-data-key"}
              ],
              "resourceRequirements": [
                {"type": "VCPU", "value": "1"},
                {"type": "MEMORY", "value": "2048"}
              ],
              "firelensConfiguration": {"type": "fluentbit", "options": {}},
              "secrets": [
                {
                  "name": "OTEL_CONFIG",
                  "valueFrom": "arn:aws:ssm:us-east-1:<ACCOUNT_ID>:parameter/your/batch/otel/collector/config"
                }
              ],
              "mountPoints": [],
              "ulimits": []
            },
            {
              "name": "<YOUR_APPLICATION_NAME>",
              "image": "<YOUR_APPLICATION_IMAGE>",
              "essential": true,
              "command": [],
              "dependsOn": [
                {"containerName": "otel-collector", "condition": "START"}
              ],
              "environment": [
                {"name": "OTEL_EXPORTER_OTLP_ENDPOINT", "value": "otel-collector:4317"}
              ],
              "resourceRequirements": [
                {"type": "VCPU", "value": "1"},
                {"type": "MEMORY", "value": "1024"}
              ],
              "logConfiguration": {
                "logDriver": "awsfirelens",
                "options": {"Name": "OpenTelemetry"},
                "secretOptions": []
              },
              "mountPoints": [],
              "secrets": [],
              "ulimits": []
            }
          ]
        }
      ]
    }
  }